import{c as y}from"./@protobufjs-79a8f228.js";import{d as B}from"./js-crypto-env-662cd866.js";var N={},w={},F={},S={};Object.defineProperty(S,"__esModule",{value:!0});var V={"AES-GCM":{nodePrefix:"aes-",nodeSuffix:"-gcm",ivLength:12,tagLength:16,staticIvLength:!0},"AES-CBC":{nodePrefix:"aes-",nodeSuffix:"-cbc",ivLength:16,staticIvLength:!0},"AES-CTR":{nodePrefix:"aes-",nodeSuffix:"-ctr",ivLength:12,staticIvLength:!1}},R={"AES-KW":{nodePrefix:"id-aes",nodeSuffix:"-wrap",ivLength:8,staticIvLength:!0,defaultIv:new Uint8Array([166,166,166,166,166,166,166,166])}};S.default={ciphers:V,wrapKeys:R};(function(n){var c=y&&y.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(n,"__esModule",{value:!0}),n.decrypt=n.encrypt=n.unwrapKey=n.wrapKey=void 0;var r=c(S),u=function(o,t,i,v){var s=i.name,d=i.iv;return(0,n.encrypt)(o,t,{name:s,iv:d},v,!0)};n.wrapKey=u;var a=function(o,t,i,v){var s=i.name,d=i.iv;return(0,n.decrypt)(o,t,{name:s,iv:d},v,!0)};n.unwrapKey=a;var e=function(o,t,i,v,s){var d=i.name,h=i.iv,T=i.additionalData,C=i.tagLength;s===void 0&&(s=!1);var A=l(d,t.byteLength,s?r.default.wrapKeys:r.default.ciphers),p;switch(d){case"AES-GCM":{p=v.createCipheriv(A,t,h,{authTagLength:C}),p.setAAD(T);break}case"AES-CTR":{if(h.length===0||h.length>16)throw new Error("InvalidIVLength");var K=new Uint8Array(16);K.set(h),K[15]+=1,p=v.createCipheriv(A,t,K);break}default:{p=v.createCipheriv(A,t,h);break}}var _,E,b;try{_=new Uint8Array(p.update(o)),E=new Uint8Array(p.final()),b=new Uint8Array([]),d==="AES-GCM"&&(b=new Uint8Array(p.getAuthTag()))}catch{throw new Error("NodeCrypto_EncryptionFailure")}var L=new Uint8Array(_.length+E.length+b.length);return L.set(_),L.set(E,_.length),L.set(b,_.length+E.length),L};n.encrypt=e;var f=function(o,t,i,v,s){var d=i.name,h=i.iv,T=i.additionalData,C=i.tagLength;s===void 0&&(s=!1);var A=l(d,t.byteLength,s?r.default.wrapKeys:r.default.ciphers),p,K;switch(d){case"AES-GCM":{p=v.createDecipheriv(A,t,h,{authTagLength:C}),p.setAAD(T),K=o.slice(0,o.length-C);var _=o.slice(o.length-C);p.setAuthTag(_);break}case"AES-CTR":{if(h.length===0||h.length>16)throw new Error("InvalidIVLength");var E=new Uint8Array(16);E.set(h),E[15]+=1,p=v.createDecipheriv(A,t,E),K=o;break}default:{p=v.createDecipheriv(A,t,h),K=o;break}}var b,L;try{b=p.update(K),L=p.final()}catch{throw new Error("NodeCrypto_DecryptionFailure")}var D=new Uint8Array(L.length+b.length);return D.set(b),D.set(L,b.length),D};n.decrypt=f;var l=function(o,t,i){var v=i[o].nodePrefix;return v="".concat(v).concat((t*8).toString()),v+i[o].nodeSuffix}})(F);var g={},U=y&&y.__awaiter||function(n,c,r,u){function a(e){return e instanceof r?e:new r(function(f){f(e)})}return new(r||(r=Promise))(function(e,f){function l(i){try{t(u.next(i))}catch(v){f(v)}}function o(i){try{t(u.throw(i))}catch(v){f(v)}}function t(i){i.done?e(i.value):a(i.value).then(l,o)}t((u=u.apply(n,c||[])).next())})},M=y&&y.__generator||function(n,c){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},u,a,e,f;return f={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function l(t){return function(i){return o([t,i])}}function o(t){if(u)throw new TypeError("Generator is already executing.");for(;r;)try{if(u=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=c.call(n,r)}catch(i){t=[6,i],a=0}finally{u=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(g,"__esModule",{value:!0});g.decrypt=g.encrypt=g.unwrapKey=g.wrapKey=void 0;var q=function(n,c,r,u){var a=r.name,e=r.iv;return U(void 0,void 0,void 0,function(){var f,l,o,t;return M(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,u.importKey("raw",c,{name:a},!1,["wrapKey","unwrapKey"])];case 1:return f=i.sent(),[4,u.importKey("raw",n,{name:a},!0,["wrapKey","unwrapKey"])];case 2:return l=i.sent(),[4,u.wrapKey("raw",l,f,{name:a,iv:e})];case 3:return o=i.sent(),[2,new Uint8Array(o)];case 4:throw t=i.sent(),t instanceof Error?new Error("WebCrypto_FailedToWrapKey - ".concat(t.message)):new Error("WebCrypto_FailedToWrapKey");case 5:return[2]}})})};g.wrapKey=q;var z=function(n,c,r,u){var a=r.name,e=r.iv;return U(void 0,void 0,void 0,function(){var f,l,o,t;return M(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,u.importKey("raw",c,{name:a},!1,["wrapKey","unwrapKey"])];case 1:return f=i.sent(),[4,u.unwrapKey("raw",n,f,{name:a,iv:e},{name:"AES-GCM"},!0,["encrypt","decrypt"])];case 2:return l=i.sent(),o=Uint8Array.bind,[4,u.exportKey("raw",l)];case 3:return[2,new(o.apply(Uint8Array,[void 0,i.sent()]))];case 4:throw t=i.sent(),t instanceof Error?new Error("WebCrypto_FailedToUnwrapKey - ".concat(t.message)):new Error("WebCrypto_FailedToUnwrapKey");case 5:return[2]}})})};g.unwrapKey=z;var H=function(n,c,r,u){var a=r.name,e=a===void 0?"AES-GCM":a,f=r.iv,l=r.additionalData,o=r.tagLength;return U(void 0,void 0,void 0,function(){var t,i,v,s;return M(this,function(d){switch(d.label){case 0:t=$({name:e,iv:f,additionalData:l,tagLength:o}),d.label=1;case 1:return d.trys.push([1,4,,5]),[4,u.importKey("raw",c,t,!1,["encrypt","decrypt"])];case 2:return i=d.sent(),[4,u.encrypt(t,i,n)];case 3:return v=d.sent(),[2,new Uint8Array(v)];case 4:throw s=d.sent(),s instanceof Error?new Error("WebCrypto_EncryptionFailure: ".concat(s.message)):new Error("WebCrypto_EncryptionFailure");case 5:return[2]}})})};g.encrypt=H;var J=function(n,c,r,u){var a=r.name,e=r.iv,f=r.additionalData,l=r.tagLength;return U(void 0,void 0,void 0,function(){var o,t,i,v;return M(this,function(s){switch(s.label){case 0:o=$({name:a,iv:e,additionalData:f,tagLength:l}),s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.importKey("raw",c,o,!1,["encrypt","decrypt"])];case 2:return t=s.sent(),[4,u.decrypt(o,t,n)];case 3:return i=s.sent(),[2,new Uint8Array(i)];case 4:throw v=s.sent(),v instanceof Error?new Error("WebCrypto_DecryptionFailure: ".concat(v.message)):new Error("WebCrypto_DecryptionFailure");case 5:return[2]}})})};g.decrypt=J;var $=function(n){var c=n.name,r=n.iv,u=n.additionalData,a=n.tagLength,e={name:c,iv:r,additionalData:u,tagLength:a};switch(c){case"AES-GCM":{e.tagLength=a*8;break}case"AES-CBC":break;case"AES-CTR":{if(r.length===0||r.length>16)throw new Error("InvalidIVLength");e.counter=new Uint8Array(16),e.counter.set(r),e.counter[15]+=1,e.length=128;break}}return e},Q=y&&y.__createBinding||(Object.create?function(n,c,r,u){u===void 0&&(u=r),Object.defineProperty(n,u,{enumerable:!0,get:function(){return c[r]}})}:function(n,c,r,u){u===void 0&&(u=r),n[u]=c[r]}),X=y&&y.__setModuleDefault||(Object.create?function(n,c){Object.defineProperty(n,"default",{enumerable:!0,value:c})}:function(n,c){n.default=c}),G=y&&y.__importStar||function(n){if(n&&n.__esModule)return n;var c={};if(n!=null)for(var r in n)r!=="default"&&Object.prototype.hasOwnProperty.call(n,r)&&Q(c,n,r);return X(c,n),c},I=y&&y.__awaiter||function(n,c,r,u){function a(e){return e instanceof r?e:new r(function(f){f(e)})}return new(r||(r=Promise))(function(e,f){function l(i){try{t(u.next(i))}catch(v){f(v)}}function o(i){try{t(u.throw(i))}catch(v){f(v)}}function t(i){i.done?e(i.value):a(i.value).then(l,o)}t((u=u.apply(n,c||[])).next())})},O=y&&y.__generator||function(n,c){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},u,a,e,f;return f={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function l(t){return function(i){return o([t,i])}}function o(t){if(u)throw new TypeError("Generator is already executing.");for(;r;)try{if(u=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=c.call(n,r)}catch(i){t=[6,i],a=0}finally{u=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}},Y=y&&y.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(w,"__esModule",{value:!0});w.unwrapKey=w.wrapKey=w.decrypt=w.encrypt=void 0;var j=G(B),W=G(F),P=G(g),m=Y(S),x=function(n){var c=n.name,r=n.iv,u=n.tagLength;if(m.default.ciphers[c].ivLength){if(!(r instanceof Uint8Array))throw new Error("InvalidArguments");if(r.byteLength<2||r.byteLength>16)throw new Error("InvalidIVLength");if(m.default.ciphers[c].staticIvLength&&m.default.ciphers[c].ivLength!==r.byteLength)throw new Error("InvalidIVLength")}if(m.default.ciphers[c].tagLength&&u){if(!Number.isInteger(u))throw new Error("InvalidArguments");if(u<4||u>16)throw new Error("InvalidTagLength")}},Z=function(n,c,r){var u=r.name,a=u===void 0?"AES-GCM":u,e=r.iv,f=r.additionalData,l=f===void 0?new Uint8Array([]):f,o=r.tagLength;return I(void 0,void 0,void 0,function(){var t;return O(this,function(i){if(x({name:a,iv:e,tagLength:o}),m.default.ciphers[a].tagLength&&!o&&(o=m.default.ciphers[a].tagLength),t=j.getCrypto(),t.name==="webCrypto"){if(typeof t.crypto.importKey!="function"||typeof t.crypto.encrypt!="function")throw new Error("UnsupportedWebCrypto");return[2,P.encrypt(n,c,{name:a,iv:e,additionalData:l,tagLength:o},t.crypto)]}else{if(t.name==="nodeCrypto")return[2,W.encrypt(n,c,{name:a,iv:e,additionalData:l,tagLength:o},t.crypto)];throw new Error("UnsupportedEnvironment")}})})};w.encrypt=Z;var k=function(n,c,r){var u=r.name,a=u===void 0?"AES-GCM":u,e=r.iv,f=r.additionalData,l=f===void 0?new Uint8Array([]):f,o=r.tagLength;return I(void 0,void 0,void 0,function(){var t;return O(this,function(i){if(x({name:a,iv:e,tagLength:o}),m.default.ciphers[a].tagLength&&!o&&(o=m.default.ciphers[a].tagLength),t=j.getCrypto(),t.name==="webCrypto"){if(typeof t.crypto.importKey!="function"||typeof t.crypto.decrypt!="function")throw new Error("UnsupportedWebCrypto");return[2,P.decrypt(n,c,{name:a,iv:e,additionalData:l,tagLength:o},t.crypto)]}else{if(t.name==="nodeCrypto")return[2,W.decrypt(n,c,{name:a,iv:e,additionalData:l,tagLength:o},t.crypto)];throw new Error("UnsupportedEnvironment")}})})};w.decrypt=k;var ee=function(n,c,r){var u=r.name;return I(void 0,void 0,void 0,function(){var a,e;return O(this,function(f){if(n.length%8>0)throw new Error("WrappedKeyMustBeMultipleOf8");if(a=j.getCrypto(),e=m.default.wrapKeys["AES-KW"].defaultIv,a.name==="webCrypto"){if(typeof a.crypto.importKey!="function"||typeof a.crypto.wrapKey!="function")throw new Error("UnsupportedWebCrypto");return[2,P.wrapKey(n,c,{name:u,iv:e},a.crypto)]}else{if(a.name==="nodeCrypto")return[2,W.wrapKey(n,c,{name:u,iv:e},a.crypto)];throw new Error("UnsupportedEnvironment")}})})};w.wrapKey=ee;var te=function(n,c,r){var u=r.name;return I(void 0,void 0,void 0,function(){var a,e;return O(this,function(f){if(a=j.getCrypto(),e=m.default.wrapKeys["AES-KW"].defaultIv,a.name==="webCrypto"){if(typeof a.crypto.importKey!="function"||typeof a.crypto.unwrapKey!="function")throw new Error("UnsupportedWebCrypto");return[2,P.unwrapKey(n,c,{name:u,iv:e},a.crypto)]}else{if(a.name==="nodeCrypto")return[2,W.unwrapKey(n,c,{name:u,iv:e},a.crypto)];throw new Error("UnsupportedEnvironment")}})})};w.unwrapKey=te;(function(n){var c=y&&y.__createBinding||(Object.create?function(e,f,l,o){o===void 0&&(o=l),Object.defineProperty(e,o,{enumerable:!0,get:function(){return f[l]}})}:function(e,f,l,o){o===void 0&&(o=l),e[o]=f[l]}),r=y&&y.__setModuleDefault||(Object.create?function(e,f){Object.defineProperty(e,"default",{enumerable:!0,value:f})}:function(e,f){e.default=f}),u=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var f={};if(e!=null)for(var l in e)l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)&&c(f,e,l);return r(f,e),f};Object.defineProperty(n,"__esModule",{value:!0}),n.unwrapKey=n.wrapKey=n.decrypt=n.encrypt=void 0;var a=u(w);n.encrypt=a.encrypt,n.decrypt=a.decrypt,n.wrapKey=a.wrapKey,n.unwrapKey=a.unwrapKey,n.default={encrypt:n.encrypt,decrypt:n.decrypt,wrapKey:n.wrapKey,unwrapKey:n.unwrapKey}})(N);export{N as d};
